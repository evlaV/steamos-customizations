#!/bin/bash

STEAMOS_BINARIES=(bash     \
                  dd       \
                  findmnt  \
                  iconv    \
                  lsblk    \
                  mkdir    \
                  mktemp   \
                  readlink \
                  tr       \
                  tune2fs  \
                  mkfs.ext4 \
                  steamos-factory-reset-config \
                  udevadm  )

build() {
    map add_binary ${STEAMOS_BINARIES[@]}

    # steamos helper scripts (eg the partset generator)
    map add_file @libexecdir@/steamos/*

    # make iconv work
    map add_file /usr/lib/gconv/gconv-modules.d/*
    map add_file /usr/lib/gconv/gconv-modules /usr/lib/gconv/*.so
    map add_file /usr/lib/locale/locale-archive

    add_runscript
}

help() {
    cat <<'HELPEOF'
This hook implements the early setup for SteamOS:
 - detection and assembly of the partition set for the chosen SteamOS image
 - set up of the rw overlays
 - initialising the module tree on /var/lib/modules on first boot
HELPEOF
}
